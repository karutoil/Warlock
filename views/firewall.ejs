<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warlock - Firewall</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/assets/frontend.css">
    <link rel="stylesheet" href="/assets/themes.css">
    <script src="/assets/common.js"></script>
</head>
<body>

<%- include('partials/nav.ejs') %>

<div class="main-container" style="grid-template-columns: 1fr; max-width: 1000px;">
    <main class="content-area">
        <div class="content-header">
            <div class="content-header-inner">
                <h2>
                    <i class="fas fa-shield-alt"></i>
                    Server Firewall
                </h2>
                <div class="content-header-buttons">
                    <button id="btnAddRule" class="action-create">
                        <i class="fas fa-plus"></i> Add Rule
                    </button>
                    <button id="btnPauseFirewall" class="action-stop" style="display: none;">
                        <i class="fas fa-pause"></i> Pause Firewall
                    </button>
                    <button id="btnEnableFirewall" class="action-start" style="display: none;">
                        <i class="fas fa-play"></i> Start Firewall
                    </button>
                </div>
                <p>Manage UFW rules on <span class="host-name-placeholder">the selected server</span></p>
            </div>
        </div>

        <div class="content-body">
            <h3>Firewall Status</h3>
            <div id="firewallStatusActive" class="success-message" style="display: none;">
                The firewall is active.
            </div>
            <div id="firewallStatusInactive" class="warning-message" style="display: none;">
                The firewall is inactive.
            </div>
            <div id="firewallStatusNotInstalled" class="error-message" style="display: none;">
                UFW is not installed on this server.
            </div>

            <br/><br/>

            <h3>Rules</h3>
            <div id="rulesContainer">
                <table class="table rules-table">
                    <thead>
                        <tr><th>To / Port</th><th>From</th><th>Protocol</th><th>Action</th><th>Comment</th><th>Actions</th></tr>
                    </thead>
                    <tbody id="firewallTableBody">
                        <tr><td colspan="6">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>
</div>

<!-- Add Rule Modal -->
<div id="addRuleModal" class="modal">
    <div class="modal-overlay"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3>Add Firewall Rule</h3>
            <button class="modal-close"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="ruleAction">Action</label>
                <select id="ruleAction">
                    <option value="ALLOW">Allow</option>
                    <option value="DENY">Deny</option>
                    <option value="REJECT">Reject</option>
                </select>
            </div>
            <div class="form-group">
                <label for="ruleProto">Protocol</label>
                <select id="ruleProto">
                    <option value="">Any</option>
                    <option value="tcp">TCP</option>
                    <option value="udp">UDP</option>
                </select>
            </div>
            <div class="form-group">
                <label for="ruleFrom">From (CIDR or IP)</label>
                <input id="ruleFrom" type="text" placeholder="any or specific IP address or CIDR block" />
            </div>
            <div class="form-group">
                <label for="ruleTo">To (destination)</label>
                <input id="ruleTo" type="text" placeholder="any, port, or port range, ie 80 or 80:90" />
            </div>
            <div class="form-group">
                <label for="ruleComment">Comment (optional)</label>
                <input id="ruleComment" type="text" placeholder="e.g., web-server" />
            </div>
        </div>
        <div class="modal-footer">
            <button id="saveRuleBtn" class="action-save">Add Rule</button>
            <button class="action-cancel modal-close">Cancel</button>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteRuleModal" class="modal">
    <div class="modal-overlay"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3>Delete Rule</h3>
            <button class="modal-close"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
            <p>Are you sure you want to delete this rule?</p>
            <pre id="deleteRulePreview"></pre>
            <input type="hidden" id="delRuleSpec" />
        </div>
        <div class="modal-footer">
            <button id="confirmDeleteRuleBtn" class="action-remove">Delete</button>
            <button class="action-cancel modal-close">Cancel</button>
        </div>
    </div>
</div>

<%- include('partials/theme-selector.ejs') %>

<script src="/assets/firewall.js"></script>
</body>
</html>

