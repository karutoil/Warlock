<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warlock - Settings</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/assets/frontend.css">
    <link rel="stylesheet" href="/assets/themes.css">
    <script src="/assets/common.js"></script>
    <script src="/assets/qrcode.min.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>

<%- include('partials/nav.ejs') %>

<div class="main-container" style="grid-template-columns: 1fr; max-width: 1000px;">
    <main class="content-area">
        <div class="content-header">
            <div class="content-header-inner">
                <h2>
                    <i class="fas fa-users-cog"></i>
                    Settings
                </h2>
                <div class="content-header-buttons">
                    <button id="btnCreateUser" class="action-create">
                        <i class="fas fa-user-plus"></i> Create User
                    </button>
                </div>
                <p>Manage platform users</p>
            </div>
        </div>

        <div class="content-body">
            <h3>Users</h3>
            <div id="usersContainer">
                <table class="table users-table">
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th title="2-Factor Authentication">2FA</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                        <tr><td colspan="3">Loading...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- App version and useful links -->
            <div class="settings-meta" style="margin-top:2rem;">
                <h3>Warlock Version</h3>
                <div class="version-infos">
                    <span>
                        Version: <strong><%= version %></strong>
                    </span>
                    <span>
                        <a href="https://ko-fi.com/bitsandbytes" target="_blank" rel="noopener" class="button action-donate">
                            <i class="fas fa-star"></i>
                            Donate
                        </a>
                    </span>
                    <span>
                        <a href="https://github.com/BitsNBytes25/Warlock" target="_blank" rel="noopener" class="button action-browse">
                            <i class="fab fa-github"></i>
                            GitHub
                        </a>
                    </span>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- Create/Edit User Modal -->
<div id="userModal" class="modal">
    <div class="modal-overlay"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="userModalTitle">Create User</h3>
            <button class="modal-close"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="inputUsername">Username</label>
                <input id="inputUsername" type="text" />
            </div>
            <div class="form-group" id="passwordRow">
                <label for="inputPassword">Password</label>
                <input id="inputPassword" type="password" />
            </div>
            <input type="hidden" id="inputUserId" />
        </div>
        <div class="modal-footer">
            <button id="saveUserBtn" class="action-save">Save</button>
            <button class="action-cancel modal-close">Cancel</button>
        </div>
    </div>
</div>

<!-- Change Password Modal -->
<div id="changePasswordModal" class="modal">
    <div class="modal-overlay"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3>Change Password</h3>
            <button class="modal-close"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="newPassword">New Password</label>
                <input id="newPassword" type="password" />
            </div>
            <input type="hidden" id="pwdUserId" />
        </div>
        <div class="modal-footer">
            <button id="savePasswordBtn" class="action-save">Set Password</button>
            <button class="action-cancel modal-close">Cancel</button>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="userDeleteModal" class="modal">
    <div class="modal-overlay"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3>Confirm Delete</h3>
            <button class="modal-close"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
            <p>Are you sure you want to delete this user?</p>
            <input type="hidden" id="delUserId" />
        </div>
        <div class="modal-footer">
            <button id="confirmDeleteUserBtn" class="action-remove">Delete</button>
            <button class="action-cancel modal-close">Cancel</button>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="user2faModal" class="modal">
    <div class="modal-overlay"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3>Two Factor Authentication</h3>
            <button class="modal-close"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
            <div id="own-user-2fa">
                <div class="info-message">
                    <p>
                        Your account has 2FA enabled and authorized.  Below is your secret key if you would like to add a new authenticator.<br/><br/>
                        Key: <strong id="own-2fa-secret"></strong>
                    </p>
                </div>

                <div id="qrcode"></div>
            </div>
            <div id="other-user-2fa">
                <div class="info-message">
                    <p>This user has 2FA enabled and activated.  You can reset their authentication to allow them to set up new authorization.</p>
                </div>

                <button id="confirmUserReset2faBtn">Reset 2FA</button>
            </div>
        </div>
    </div>
</div>

<%- include('partials/theme-selector.ejs') %>

<script>
    const twofactor = <%= twofactor ? 'true' : 'false' %>;
</script>
<script src="/assets/settings.js"></script>
</body>
</html>
