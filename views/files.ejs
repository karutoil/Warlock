<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warlock - File Manager</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/assets/frontend.css">
    <link rel="stylesheet" href="/assets/themes.css">
    <script src="/assets/common.js"></script>
</head>
<body>
<%- include('partials/nav.ejs') %>

    <div class="files-container">
        <div class="files-layout">
            <!-- Left: File Browser -->
            <div class="browser-card">
                <div class="card-header">
                    <div class="path-controls">
                        <div class="current-path" id="currentPath">/home/steam</div>
                        <div class="action-buttons" style="margin-top: 0.5rem;">
                            <button id="createFolderBtn" class="btn-nav btn-action" title="Create Folder">
                                <i class="fas fa-folder-plus"></i>
                                Folder
                            </button>
                            <button id="createFileBtn" class="btn-nav btn-action" title="Create File">
                                <i class="fas fa-plus"></i>
                                File
                            </button>
                            <button id="uploadBtn" class="btn-nav btn-upload" title="Upload Files">
                                <i class="fas fa-cloud-upload-alt"></i>
                                Upload
                            </button>
                            <input type="file" id="fileInput" multiple style="display: none;" />
                            <button id="refreshBtn" class="btn-nav" title="Refresh">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                            <button id="upBtn" class="btn-nav" title="Go Up">
                                <i class="fas fa-level-up-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- File Search -->
                <!--<div style="padding: 1rem; border-bottom: 1px solid rgba(0, 150, 255, 0.2);">
                    <div style="position: relative;">
                        <i class="fas fa-search" style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: #64748b;"></i>
                        <input type="text" id="fileSearch" placeholder="Search files and folders..." style="width: 100%; padding: 0.75rem 2.5rem 0.75rem 2.5rem; background: rgba(0, 40, 80, 0.4); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 8px; color: #e2e8f0; font-size: 0.9rem; outline: none; transition: all 0.3s;">
                        <button id="searchClear" style="position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%); background: none; border: none; color: #64748b; cursor: pointer; padding: 0.5rem; display: none;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                -->
                
                <div class="file-browser" style="height: 100%; overflow-y: auto;">
                    <div class="sidebar-browser">
                        <div class="quick-paths">

                        </div>
                    </div>
                    
                    <div class="main-browser">
                        <div id="fileList" class="file-list">
                            <div style="text-align: center; color: #666; padding: 2rem;">
                                <i class="fas fa-folder-open" style="font-size: 2rem; margin-bottom: 1rem; display: block;"></i>
                                Click "Refresh" or select a quick path to browse files
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Resizer -->
            <div class="resizer"></div>
            
            <!-- Right: File Viewer/Editor -->
            <div class="file-viewer-card">
                <div class="card-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                    <h2 id="viewerTitle">
                        <i class="fas fa-file"></i>
                        File Viewer
                    </h2>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <!-- Search Bar (shown when viewing/editing) -->
                        <div id="viewerSearchBar" class="search-bar" style="display: none; align-items: center; gap: 0.5rem;">
                            <input type="text" id="viewerSearch" class="search-input" placeholder="Search in file..." style="width: 200px; padding: 0.4rem 0.8rem; font-size: 0.85rem;">
                            <div class="button-group">
                                <button id="viewerSearchPrev" class="btn-editor" style="padding: 0.4rem 0.8rem;">
                                    <i class="fas fa-chevron-up"></i>
                                </button>
                                <button id="viewerSearchNext" class="btn-editor" style="padding: 0.4rem 0.8rem;">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                            </div>
                            <span id="viewerSearchCount" style="font-size: 0.85rem; color: #94a3b8;"></span>
                        </div>
                        <!-- Action Buttons -->
                        <div id="viewerActions" class="action-buttons" style="display: none; gap: 0.5rem;">
                            <button id="saveFileBtn" class="action-save">
                                <i class="fas fa-save"></i>
                                Save
                            </button>
                            <button id="downloadFileBtn" class="action-download">
                                <i class="fas fa-download"></i>
                                Download
                            </button>
                            <button id="restoreBackupFileBtn" class="action-restore">
                                <i class="fas fa-undo"></i>
                                Restore Backup
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Empty State -->
                <div id="viewerEmptyState" style="flex: 1; overflow: auto; padding: 1.5rem; background: rgba(0, 0, 0, 0.3); display: none; align-items: center; justify-content: center;">
                    <div style="text-align: center; color: #666; padding: 4rem 2rem;">
                        <i class="fas fa-file-alt" style="font-size: 4rem; margin-bottom: 1rem; display: block; opacity: 0.3;"></i>
                        <p style="font-size: 1.1rem;">Select a file to view or edit</p>
                    </div>
                </div>

                <!-- Loading State -->
                <div id="viewerLoadingState" style="flex: 1; overflow: auto; padding: 1.5rem; background: rgba(0, 0, 0, 0.3); display: flex; align-items: center; justify-content: center;">
                    <div style="text-align: center; color: #666; padding: 4rem 2rem;">
                        <i class="fas fa-file-alt" style="font-size: 4rem; margin-bottom: 1rem; display: block; opacity: 0.3;"></i>
                        <p style="font-size: 1.1rem;">Loading Content, please wait a moment</p>
                        <p style="font-size:4rem; margin-top:1rem;"><i class="fas fa-spinner fa-spin"></i></p>
                    </div>
                </div>
                
                <!-- File Preview (for viewing) -->
                <div id="filePreviewContent" class="file-preview">
                    <div id="previewContent"></div>
                </div>
                
                <!-- File Editor (for editing) -->
                <div id="fileEditorContent" style="display: none; flex: 1; overflow: hidden; flex-direction: column;">
                    <textarea id="editorTextarea" style="flex: 1; width: 100%; padding: 1.5rem; background: rgba(0, 0, 0, 0.5); color: #e2e8f0; border: none; font-family: 'Monaco', 'Menlo', monospace; font-size: 0.9rem; line-height: 1.6; resize: none; outline: none;" placeholder="File content will appear here..."></textarea>
                    <div style="padding: 0.75rem 1.5rem; background: rgba(0, 40, 80, 0.4); border-top: 1px solid rgba(0, 150, 255, 0.2); display: flex; justify-content: space-between; font-size: 0.85rem; color: #87ceeb;">
                        <span id="editorInfo">Ready to edit</span>
                        <span id="editorStats"></span>
                    </div>
                </div>
            </div>
        </div>
        
    </div>

    <!-- Create Folder Modal -->
    <div id="createFolderModal" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-folder-plus"></i> Create New Folder</h3>
                <button class="modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="folderName">Folder Name:</label>
                    <input type="text" id="folderName" placeholder="Enter folder name..." />
                </div>
            </div>
            <div class="modal-footer">
                <button class="action-create" id="confirmCreateFolder">
                    <i class="fas fa-folder-plus"></i>
                    Create Folder
                </button>
                <button class="action-cancel modal-close">
                    <i class="fas fa-times"></i>
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Create File Modal -->
    <div id="createFileModal" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-file"></i> Create New File</h3>
                <button class="modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="fileName">File Name:</label>
                    <input type="text" id="fileName" placeholder="Enter file name with extension..." />
                </div>
                <div class="form-group">
                    <label for="fileContent">Initial Content (optional):</label>
                    <textarea id="fileContent" rows="6" placeholder="Enter initial file content..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="action-save" id="confirmCreateFile">
                    <i class="fas fa-save"></i>
                    Create File
                </button>
                <button class="action-cancel modal-close">
                    <i class="fas fa-times"></i>
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteConfirmModal" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-exclamation-triangle"></i> Confirm Deletion</h3>
                <button class="modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="warning-message">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>
                        <p>This will permanently delete the item and all its contents!</p>
                        <p class="filename"></p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="action-remove" id="confirmDelete">
                    <i class="fas fa-trash"></i>
                    Delete Permanently
                </button>
                <button class="action-cancel modal-close">
                    <i class="fas fa-times"></i>
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Rename Modal -->
    <div id="renameModal" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Rename Item</h3>
                <button class="modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div style="background: rgba(251, 191, 36, 0.1); border: 1px solid rgba(251, 191, 36, 0.3); border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem;">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 1.5rem; color: #fbbf24;"></i>
                        <div>
                            <p style="color: #fcd34d; margin: 0; font-size: 0.85rem;">Renaming files or folders may break applications or scripts that depend on the current name or path!</p>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="renameNewName">New Name:</label>
                    <input type="text" id="renameNewName" placeholder="Enter new name..." />
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-nav btn-action" id="confirmRename">
                    <i class="fas fa-edit"></i>
                    Rename
                </button>
                <button class="action-cancel modal-close">
                    <i class="fas fa-times"></i>
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Context Menu -->
    <div id="contextMenu" class="context-menu">
        <button class="action-rename context-menu-item" id="contextRename">
            <i class="fas fa-edit"></i>
            <span>Rename</span>
        </button>
        <button class="action-download context-menu-item" id="contextDownload">
            <i class="fas fa-download"></i>
            <span>Download</span>
        </button>
        <button class="action-extract context-menu-item" id="contextExtract">
            <i class="fas fa-file-zipper"></i>
            <span>Extract Archive</span>
        </button>
        <button class="action-remove context-menu-item" id="contextDelete">
            <i class="fas fa-trash"></i>
            <span>Delete</span>
        </button>
    </div>

    <!-- Upload Progress Modal -->
    <div id="uploadModal" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-cloud-upload-alt"></i> Upload Files</h3>
                <button class="modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="uploadProgress" class="upload-progress">
                    <div class="upload-status">Ready to upload files...</div>
                    <div class="progress-bar" style="display: none;">
                        <div class="progress-fill"></div>
                    </div>
                    <div id="uploadFileList" class="upload-file-list"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-nav btn-upload" id="confirmUpload">
                    <i class="fas fa-cloud-upload-alt"></i>
                    Start Upload
                </button>
                <button class="action-cancel modal-close">
                    <i class="fas fa-times"></i>
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Restore Backup (and confirmation) Modal -->
    <div id="restoreConfirmModal" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-undo"></i> Restore Backup</h3>
                <button class="modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="warning-message">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>
                        Warning: Restoring a backup will overwrite the current game environment!
                        <br/><br/>
                        Restore file from <span class="timestamp">unknown date</span>
                    </p>
                </div>
                <div class="terminal"></div>
            </div>
            <div class="modal-footer">
                <button class="action-restore" id="confirmRestore">
                    <i class="fas fa-undo"></i>
                    Confirm Restore
                </button>
                <button class="action-cancel modal-close">
                    <i class="fas fa-times"></i>
                    Cancel
                </button>
            </div>
        </div>
    </div>

<%- include('partials/theme-selector.ejs') %>
<script src="/assets/files.js"></script>
</body>
</html>